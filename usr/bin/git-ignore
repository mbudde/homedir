#!/bin/bash
# Michael Budde <mbudde@gmail.com>
# Add globs to .gitignore

read -d '' USAGE <<"EOF"
[options] [<glob>...]

Options:
    -r              use repo excludes file
    -g              use global excludes file
    -f <FILE>       use given file
    -e              opens an editor
EOF
. "$(git --exec-path)/git-sh-setup"

while getopts "hergf:" opt; do
    case $opt in
        e)
            action="edit"
            ;;
        r)
            file=$(git rev-parse --git-dir)/info/exclude
            ;;
        g)
            file=$(git config core.excludesfile) || \
                die "Configuration option core.excludesfile is not set."
            file=${file/~\//$HOME/}
            ;;
        f)
            file="$OPTARG"
            ;;
        h | \?)
            usage
            ;;
    esac
done
shift $((OPTIND-1))

file=${file:-$(git rev-parse --show-cdup)".gitignore"}
case ${action:-add} in
    edit)
        git_editor "$file"
        ;;
    add)
        if [ $# -eq 0 ]; then
            $(git var GIT_PAGER) "$file"
        else
            for glob in "$@"; do
                echo $glob >> "$file"
            done
        fi
        ;;
esac
